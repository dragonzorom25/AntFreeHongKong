<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default_layout}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 계정 관리 - MyBaseLink</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --border-color: #dcdfe6;
            --text-main: #303133;
            --text-sub: #606266;
            --hover-bg: #f5f7fa;
            --overlay-bg: rgba(0, 0, 0, 0.5);
            --danger-color: #f56c6c;
            --success-color: #67c23a;
        }

        /* 레이아웃 전체 높이 보정 */
        .content-container {
            display: flex;
            flex-direction: column;
            /* 상단 메뉴/헤더 높이를 뺀 나머지 전체를 차지하도록 설정 */
            height: calc(100vh - 100px); 
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden; /* 컨테이너 자체 스크롤 방지 */
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .page-title h2 { margin: 0; font-size: 1.3rem; font-weight: 700; color: var(--text-main); }
        .breadcrumb { font-size: 0.8rem; color: var(--text-sub); }

        /* 좌우 그리드 레이아웃 */
        .admin-wrapper {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 20px;
            flex: 1;
            min-height: 0; /* 자식 요소의 overflow:auto가 작동하기 위해 필수 */
            padding-bottom: 5px; /* 바닥 여유 */
        }

        /* 패널 공통 스타일 */
        .panel {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            height: 100%; /* 부모 높이에 맞춤 */
            overflow: hidden;
        }

        .panel-header {
            padding: 12px 20px;
            background: #fff;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        /* 내부 스크롤 영역 */
        .panel-body {
            flex: 1;
            overflow-y: auto;
            position: relative;
            -webkit-overflow-scrolling: touch;
        }

        /* 테이블 고정 헤더 */
        .user-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .user-table thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #f9fafb;
            padding: 12px 15px;
            text-align: left;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-sub);
            border-bottom: 1px solid var(--border-color);
        }
        
        .user-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.85rem;
            background: #fff;
        }

        .user-row:hover td { background-color: var(--hover-bg); }
        .row-active td {
            background-color: #f0f7ff !important;
            border-bottom: 1px solid #c6e2ff;
            color: var(--primary-color);
        }

        /* 상태 배지 */
        .status-badge {
            font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; font-weight: bold;
        }
        .status-badge.inactive { background: #fff1f0; color: var(--danger-color); border: 1px solid #ffa39e; }
        .status-badge.active { background: #f6ffed; color: var(--success-color); border: 1px solid #b7eb8f; }

        /* 버튼 */
        .btn {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 14px; border-radius: 6px; font-size: 0.85rem; font-weight: 500;
            transition: all 0.2s; cursor: pointer; border: none;
        }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: #357abd; }
        .btn-outline { border: 1px solid var(--border-color); color: var(--text-sub); background: #fff; }

        /* 상세 폼 */
        .form-container { padding: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.8rem; font-weight: 600; color: var(--text-sub); }
        .form-control {
            width: 100%; padding: 9px 12px; border: 1px solid var(--border-color); border-radius: 6px;
            font-size: 0.85rem; outline: none; transition: border-color 0.2s;
        }
        .form-control:focus { border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.1); }
        .form-control:read-only { background-color: #f8fafc; color: #94a3b8; }

        /* 스크롤바 */
        .panel-body::-webkit-scrollbar { width: 5px; }
        .panel-body::-webkit-scrollbar-track { background: transparent; }
        .panel-body::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }

        @media (max-width: 1024px) {
            .content-container { height: auto; overflow: visible; }
            .admin-wrapper { grid-template-columns: 1fr; height: auto; }
            .panel { height: 600px; } /* 모바일에서 최소 높이 */
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="content-container">
        <!-- 상단 헤더 섹션 -->
        <div class="page-header">
            <div class="page-title">
                <h2><i class="fas fa-users-cog text-blue-500 mr-2"></i>사용자 계정 관리</h2>
            </div>
            <div class="breadcrumb">
                <i class="fas fa-home mr-1"></i>
                <span>시스템 설정 / 사용자 계정 관리</span>
            </div>
        </div>

        <div class="admin-wrapper">
            <!-- 좌측: 사용자 리스트 -->
            <div class="panel">
                <div class="panel-header">
                    <h3><i class="fas fa-list-ul"></i> 전체 사용자 <span id="userCount" class="bg-blue-50 text-blue-500 px-2 rounded-full text-xs">0</span></h3>
                    <div class="flex gap-2">
                        <div class="relative">
                            <i class="fas fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-400 text-[10px]"></i>
                            <input type="text" id="userSearch" onkeyup="filterUsers()" placeholder="사용자 검색..." 
                                   class="pl-8 pr-3 py-1.5 border border-slate-200 rounded text-xs outline-none focus:border-blue-400 w-40">
                        </div>
                        <button onclick="initNewUser()" class="btn btn-primary" style="padding: 4px 10px; font-size: 0.75rem;">
                            <i class="fas fa-plus"></i> 신규추가
                        </button>
                    </div>
                </div>
                <div class="panel-body">
                    <table class="user-table">
                        <thead>
                            <tr>
                                <th>사용자 정보</th>
                                <th>이메일</th>
                                <th>권한</th>
                                <th class="text-center">상태</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <!-- JS 렌더링 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 우측: 상세 정보 -->
            <div class="panel">
                <div class="panel-header bg-slate-50/50">
                    <h3 id="detailTitle"><i class="fas fa-id-card"></i> 상세 설정</h3>
                </div>
                
                <div class="panel-body">
                    <!-- 초기 상태 뷰 -->
                    <div id="formPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-slate-300 text-center p-10">
                        <i class="fas fa-user-circle fa-4x mb-4 opacity-10"></i>
                        <p class="text-sm font-medium">사용자를 선택하여<br>정보를 확인하거나 수정하세요.</p>
                    </div>

                    <!-- 편집 폼 -->
                    <div id="saveForm" class="hidden form-container">
                        <form id="userFormData" class="space-y-4">
                            <input type="hidden" id="userId">
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label>아이디</label>
                                    <input type="text" id="username" class="form-control" placeholder="ID 입력">
                                </div>
                                <div class="form-group">
                                    <label>비밀번호</label>
                                    <input type="password" id="password" class="form-control" placeholder="변경 시 입력">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>성명</label>
                                <input type="text" id="fullName" class="form-control">
                            </div>

                            <div class="form-group">
                                <label>이메일</label>
                                <input type="email" id="email" class="form-control">
                            </div>

                            <div class="form-group">
                                <label>연락처</label>
                                <input type="text" id="phone" class="form-control">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label>권한 등급</label>
                                    <select id="role" class="form-control">
                                        <option value="USER">USER (일반)</option>
                                        <option value="MANAGER">MANAGER (운영)</option>
                                        <option value="ADMIN">ADMIN (관리)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>상태</label>
                                    <select id="status" class="form-control">
                                        <option value="active">사용</option>
                                        <option value="inactive">미사용</option>
                                    </select>
                                </div>
                            </div>

                            <div class="pt-6 flex gap-2">
                                <button type="button" onclick="cancelEdit()" class="btn btn-outline flex-1">취소</button>
                                <button type="button" onclick="submitForm()" class="btn btn-primary flex-[2] justify-center">변경내용 저장</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="pageScript">
<script>
    // 1. 샘플 데이터
    let users = [
        { id: 1, username: 'ADMIN_DEV', email: 'admin@mybaselink.com', fullName: '홍길동(관리자)', phone: '010-1234-5678', role: 'ADMIN', status: 'active' },
        { id: 2, username: 'KYLE_LEE', email: 'kyle@baselink.co.kr', fullName: '이정진', phone: '010-9876-5432', role: 'USER', status: 'active' },
        { id: 3, username: 'TEST_USER', email: 'test@gmail.com', fullName: '박미진', phone: '010-2222-3333', role: 'USER', status: 'inactive' },
        { id: 4, username: 'MANAGER_SYS', email: 'manager@base.link', fullName: '이서윤', phone: '010-4444-5555', role: 'MANAGER', status: 'active' },
        { id: 5, username: 'GUEST_01', email: 'guest1@naver.com', fullName: '김손님', phone: '010-5555-6666', role: 'USER', status: 'active' },
        { id: 6, username: 'GUEST_02', email: 'guest2@naver.com', fullName: '최손님', phone: '010-7777-8888', role: 'USER', status: 'active' }
    ];

    let selectedId = null;

    document.addEventListener("DOMContentLoaded", () => {
        renderTable();
    });

    function renderTable() {
        const tbody = document.getElementById('userTableBody');
        document.getElementById('userCount').innerText = users.length;
        
        tbody.innerHTML = users.map(u => `
            <tr onclick="loadUser(${u.id})" class="user-row cursor-pointer ${selectedId === u.id ? 'row-active' : ''}">
                <td>
                    <div class="flex items-center gap-3">
                        <div class="w-7 h-7 rounded bg-slate-100 text-slate-400 flex items-center justify-center text-[10px] font-bold">
                            ${u.username.substring(0,2)}
                        </div>
                        <div>
                            <div class="font-bold text-slate-700">${u.username}</div>
                            <div class="text-[10px] text-slate-400">${u.fullName}</div>
                        </div>
                    </div>
                </td>
                <td class="text-slate-500 text-xs">${u.email}</td>
                <td><span class="text-[10px] font-bold px-1.5 py-0.5 rounded border ${u.role === 'ADMIN' ? 'border-purple-200 text-purple-600' : 'border-blue-200 text-blue-600'}">${u.role}</span></td>
                <td class="text-center">
                    <span class="status-badge ${u.status === 'active' ? 'active' : 'inactive'}">
                        ${u.status === 'active' ? '사용' : '정지'}
                    </span>
                </td>
            </tr>
        `).join('');
    }

    function loadUser(id) {
        selectedId = id;
        const user = users.find(u => u.id === id);
        if(!user) return;

        showForm(true);
        document.getElementById('detailTitle').innerHTML = `<i class="fas fa-edit text-blue-500 mr-2"></i> 사용자 정보 수정`;
        document.getElementById('userId').value = user.id;
        document.getElementById('username').value = user.username;
        document.getElementById('username').readOnly = true;
        document.getElementById('fullName').value = user.fullName;
        document.getElementById('email').value = user.email;
        document.getElementById('phone').value = user.phone;
        document.getElementById('role').value = user.role;
        document.getElementById('status').value = user.status;
        document.getElementById('password').value = ""; 

        renderTable();
    }

    function initNewUser() {
        selectedId = null;
        showForm(true);
        document.getElementById('detailTitle').innerHTML = `<i class="fas fa-plus-circle text-green-500 mr-2"></i> 신규 계정 등록`;
        document.getElementById('userFormData').reset();
        document.getElementById('userId').value = "";
        document.getElementById('username').readOnly = false;
        renderTable();
    }

    function showForm(isVisible) {
        document.getElementById('formPlaceholder').classList.toggle('hidden', isVisible);
        document.getElementById('saveForm').classList.toggle('hidden', !isVisible);
    }

    function cancelEdit() {
        showForm(false);
        selectedId = null;
        renderTable();
    }

    function filterUsers() {
        const val = document.getElementById('userSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#userTableBody tr');
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(val) ? '' : 'none';
        });
    }

    function submitForm() {
        const username = document.getElementById('username').value;
        if(!username) {
            alert('아이디를 입력해주세요.');
            return;
        }
        alert('성공적으로 저장되었습니다.');
        cancelEdit();
    }
</script>
</th:block>

</body>
</html>