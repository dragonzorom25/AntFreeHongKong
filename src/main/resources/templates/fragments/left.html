<!-- templates/fragments/left.html -->
<div th:fragment="leftFragment">
  <nav id="left" class="sidebar">
    <ul>
      <!-- 홈 -->
      <li>
        <a href="/pages/main/base"><i class="fas fa-home"></i><span>홈</span></a>
      </li>
      
     <!-- 관리 -->
	 <li class="has-submenu">
      <a href="#" class="submenu-toggle">
        <i class="fas fa-tasks"></i><span>종목</span>
        <i class="fas fa-chevron-right toggle-icon"></i>
      </a>
      <ul class="submenu">
        <li><a href="/pages/stock/stockList">K-Stock List</a></li>
      </ul>
    </li>
      
      
      <!-- Stock -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-chart-line"></i><span>K-Stock Ai</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/stock/stockBatchAthenaAi">Athena Ai</a></li>
        </ul>
      </li>
      
      <!-- Stock 뉴스/공시 -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-file-alt"></i><span>Stock 뉴스/공시</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
          <li><a href="/pages/news/newsDartTypeAList">DART 공시</a></li>
          <li><a href="/pages/news/newsNaverTypeAList">네이버 API</a></li>
          <li><a href="/pages/news/newsRssTypeAList">뉴스통합 RSS</a></li>
        </ul>
      </li>
      
      <!-- Job -->
		<li class="has-submenu">
		  <a href="#" class="submenu-toggle">
		    <i class="fas fa-history"></i><span>Batch</span>
		    <i class="fas fa-chevron-right toggle-icon"></i>
		  </a>
		  <ul class="submenu">
		    <li><a href="/pages/stock/stockBatchGProd">K-Stock Global Batch</a></li>
		    <li><a href="/pages/sy/syfile/syFileStockPythonProd">Prod 파이썬 업로드</a></li>
		  </ul>
		</li>

      <!-- 리포트 관리 -->
	<li class="has-submenu">
      <a href="#" class="submenu-toggle">
        <i class="fas fa-chart-pie"></i><span>리포트</span>
        <i class="fas fa-chevron-right toggle-icon"></i>
      </a>
      <ul class="submenu">
        <li><a href="/pages/p01/p01a05/p01a05List">기본테이블</a></li>
      </ul>
    </li>
 
      <!-- 설정 -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
			<i class="fas fa-desktop"></i><span>시스템</span>
    		<i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
        	<li><a href="/pages/sy/syProg">프로그램 관리</a></li>
        	<li><a href="/pages/sy/syMenu">메뉴 관리</a></li>
        	<li><a href="/pages/sy/syUser">사용자 관리</a></li>
        	<li><a href="/pages/sy/syRole">권한그룹 관리</a></li>
        	<li><a href="/pages/sy/sythema">테마그룹 관리</a></li>
        	
            <!-- <li><a href="/pages/sy/syusr/syusr01List">사용자 관리</a></li> -->
        </ul>
      </li>
      
            <!-- 설정 -->
      <li class="has-submenu">
        <a href="#" class="submenu-toggle">
          <i class="fas fa-cog"></i><span>설정</span>
          <i class="fas fa-chevron-right toggle-icon"></i>
        </a>
        <ul class="submenu">
        	<li><a href="#">옵션1</a></li>
        </ul>
      </li>
    </ul>
  </nav>

  <script>
  /* ===============================================================
  ✅ Sidebar Menu Control (v1.5 - 직계 submenu 정확 제어)
  ---------------------------------------------------------------
  ✔ 오픈 / 닫기 정상
  ✔ CSS selector와 100% 일치
  ✔ fragment 중복 로드 방지
  =============================================================== */
  (function initLeftMenu() {
	  const sidebar = document.querySelector(".sidebar");
	  if (!sidebar) return;

	  // 1. 초기 셋팅: URL 기준 active 처리 (최초 1회)
	  const currentUrl = window.location.pathname;
	  const allLinks = sidebar.querySelectorAll("a");
	  
	  allLinks.forEach(link => {
	    const href = link.getAttribute("href");
	    if (href && href !== "#" && currentUrl === href) {
	      link.classList.add("active");
	      let parent = link.closest(".has-submenu");
	      while (parent) {
	        parent.classList.add("open");
	        const sub = parent.querySelector(".submenu");
	        if(sub) sub.style.display = "block";
	        parent = parent.parentElement.closest(".has-submenu");
	      }
	    }
	  });

	  // 2. ✅ 클릭 이벤트 (충돌 방지를 위해 모든 기존 이벤트 무시 처리)
	  sidebar.querySelectorAll(".submenu-toggle").forEach(toggle => {
	    // 이전 이벤트를 싹 지우기 위해 복제 후 교체하는 초강수
	    const newToggle = toggle.cloneNode(true);
	    toggle.parentNode.replaceChild(newToggle, toggle);

	    newToggle.onclick = function(e) {
	      e.preventDefault();
	      e.stopPropagation();

	      const parentLi = this.closest(".has-submenu");
	      const submenu = parentLi.querySelector(".submenu");

	      if (!submenu) return;

	      // ✅ [핵심] 현재 눈에 보이는지 여부로만 판단한다 (클래스에 의존 X)
	      const isVisible = submenu.style.display === "block";

	      if (isVisible) {
	        // 현재 열려있으면 -> 무조건 닫는다
	        parentLi.classList.remove("open");
	        submenu.style.setProperty("display", "none", "important");
	      } else {
	        // 현재 닫혀있으면 -> 무조건 연다
	        parentLi.classList.add("open");
	        submenu.style.setProperty("display", "block", "important");
	      }
	    };
	  });
	})();
  </script>
</div>